# Модальные окна

## Триггер
## Триггер: HTML-разметка
**Тег**
- Тег `<a>` — для важных окон
  - Для открытия важных модальных окно, имеющих отдельную запасную страницу (например, страница регистрации/авторизации)
  - Адрес запасной страницы указывается в атрибуте "href" на случай, если JS не сработает или будет нажатие средней кнопкой мыши
- Тег `<button>` — для обычных окон
  - Для открытия модальных окон, не имеющих отдельных страниц (например, если окно предназначено для получения подтверждения о действии)

**Целевое окно**
- Атрибут "data-open-modal"
- Содержит ID элемента модального окна, которое нужно открыть
- Пример: `data-open-modal="m1"`

**Ручная обработка клика**
- Атрибут "data-manual-open"
- Отключает автоматическое открытие модального окна, позволяя написать свой обработчик клика
- Пример: `data-manual-open="true"`

**Триггер всплывающего окна**
- Атрибут "aria-haspopup"
- Сообщает скринридерам, что кнопка вызывает всплывающее окно
- У атрибута могут и быть другие значения, но для модальных окон нужно указывать `dialog`
- Для тега `<a>` указывать не нужно (источник — валидатор "create-react-app")
- Пример: `aria-haspopup="dialog"`



## Модальное окно
## Модальное окно: HTML-разметка
**Тег**
- Использовать тег `<dialog>` (раньше был `<section>`)
- Он семантически предназначен для модальных или других диалоговых окон

**Размещение в документе**
- Элемент окна размещать в конце документа перед закрывающим тегом `</body>`

**Уникальный ID**
- Атрибут "id"
- Содержит уникальный идентификатор, по которому может быть найдено
- Пример: `id="modal1"`

**Доступная роль**
- Атрибут "role"
- Сообщает скринридерам, что элемент является диалоговым окном
- Пример: `role="dialog"`
- Примечание: Если используется тег `<dialog>`, добавлять роль не нужно

**Доступный тип**
- Атрибут "aria-modal"
- Сообщает скринридерам, что при открытии диалогового окна, элементы под ним не должны быть доступны для взаимодействия
- Пример: `aria-modal="true"`
- Примечание: Если используется, обязательно нужно добавить атрибут `role="dialog"`
- Примечание: Вроде не нужно при использовании тега `<dialog>`

**Фокус с клавиатуры**
- Атрибут "tabindex"
- Управляет возможностью поставить фокус на окно с клавиатуры
- В скрытом состоянии должно иметь значение "-1", при открытии окна "0"
- Пример: `tabindex="-1"`, `tabindex="0"`
- Аргументы против:
  - Нельзя использовать с тегом `<dialog>` (источник — MDN)[https://developer.mozilla.org/en-US/docs/Web/HTML/Element/dialog]
  - Нет смысла использовать "tabindex", если используется "visibility: hidden" (не даёт установить фокус с клавиатуры) и "aria-hidden: true" скрывает от скринридеров, убирая из дерева доступности (источник)[https://habr.com/ru/post/519662/]

**Доступный заголовок**
- Атрибут "aria-labelledby"
- Содержит ID дочернего элемента, выступающего заголовком модального окна
- При открытии модального окна, скринридер озвучит этот заголовок
- Пример: `aria-labelledby="modal1-title"`

**Доступное описание**
- Атрибут "aria-describedby"
- Содержит ID дочернего элемента, выступающего текстовым содержимым модального окна
- При открытии модального окна, скринридер озвучит это описание
- Если текстовых элементов много, обернуть в общий родитель и указать его ID
- Атрибут следует добавлять только в том случае, если у модального окна есть статический текст
- Пример: `aria-describedby="modal1-desc"`

## Модальное окно: CSS-стилизация
**Переопределение стилей браузеров**
- Браузеры ограничивают размер элемента `<dialog>`
- Нужно обязательно переназначать свойства максимальной ширины и высоты

## Модальное окно: Доступность
**Скрытое окно**
- Вроде не нужно, если используется тег `<dialog>`
1. Скрыть визуально:
  - Стандартные стили должны соответствовать классу `.srOnly`
2. Убрать из дерева доступности (скрыть от скринридеров):
  - Атрибуту `aria-hidden` задать значение `true`
3. Исключить из навигации с клавиатуры:
  - Атрибуту `tabindex` задать значение `-1`
4. Скрыть в браузере (чтобы текстовое содержимое не находилось через поиск браузера):
  - CSS-свойству `visibility` задать значение `hidden`

**Открытое окно**
- Вроде не нужно, если используется тег `<dialog>`
1. Отобразить визуально:
  - Сбросить значения свойств класса `.srOnly`
2. Вернуть в дерево доступности (показать скринридерам):
  - Атрибуту `aria-hidden` задать значение `false`
3. Вернуть в навигацию с клавиатуры:
  - Атрибуту `tabindex` задать значение `0`
4. Отобразить в браузере (чтобы текстовое содержимое находилось через поиск браузера):
  - CSS-свойству `visibility` задать значение `visible`

## Модальное окно: JavaScrit-поведение
**Dataset атрибут**
- Атрибут `data-modal`
- Для тега `<dialog>` устанавливается атрибут, который позволит работать с главным тегом через JS

**Открытие функцией "showModal()"**
- Открывает в режиме "модального окна"
  - Добавляет псевдоэлемент подложки
  - Делает недоступными для взаимодействия другие элементы
- Такой подход даёт дополнительные преимущества
  - Можно закрывать окно методом `.close()`
  - Можно закрывать окно кнопкой внутри формы с `method="dialog"`

**Принудительная прокрутка после открытия**
- При открытии окна браузер может скроллить к первому интерактивному элементу, поэтому после открытия сделана принудительная прокрутка вверх

**Фокус при открытии**
- При открытии окна, фокус ставится на первый интерактивный элемент
- Если есть кнопка с атрибутом `data-focus`, поставить фокус на неё

**Удержание фокуса в окне**
- Фокус на элементах окна зациклен
- При нажатии "Tab" на последнем элементе, переводить фокус на первый
- При нажатии "Shift+Tab" на первом элементе, переводить фокус на последний

**Фокус при закрытии окна**
- При закрытии окна фокус должен быть помещён на триггер, вызвавший модальное окно



## Backdrop (подложка)
**Элемент**
- Подложкой может выступать сам элемент модального окна или отдельный элемент в конце `<body>` (его можно создавать автоматически через JS)



## Кнопки внутри окна
**Кнопка "Закрыть"**
- Кнопка, нажатие на которую приводит просто к закрытию окна
- Обязательно наличие хотя бы одной такой кнопки, а общее количество может быть любым
- Обозначается атрибутом `data-close-btn`
- Пример: кнопка "Отмена" или "X"
- Не использовать кнопку внутри формы с атрибутом `method="dialog"`
  - Такой способ закрытия не позволит контролировать условия закрытия

**Кнопка с фокусом**
- Получает фокус при открытии окна, что позволяет сразу активировать её нажатием "Enter"
- Может быть только одна на всё окно
- Обозначается атрибутом `data-focus`
- Пример: кнопка "Ок"

**Кнопка для "Ctrl+Enter"**
- Активируется нажатием "Ctrl+Enter" на клавиатуре
- Уместно использовать, когда в окне есть другие интерактивные элементы
- Может быть только одна на всё окно
- Обозначается атрибутом `data-ctrl-enter-btn`
- Пример: кнопка "Отправить на модерацию", кнопка "Опубликовать"
